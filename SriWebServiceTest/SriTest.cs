using SRIIntegration.Response.Authorization;
using SRIIntegration.Response.Reception;
using SRIIntegration.SoapClient;
using System.Net;
using System.Xml.Serialization;

namespace SriWebServiceTest
{
    public class SriTest
    {
        [Fact]
        public void ReceptionTest()
        {
            //Arrange
            string url = "https://celcer.sri.gob.ec/comprobantes-electronicos-ws";
            string path = "/RecepcionComprobantesOffline?wsdl";
            HttpClientConnection client = new HttpClientConnection(url);

            string base64XmlInvoice = "PD94bWwgdmVyc2lvbj0iIjEuMCIiIGVuY29kaW5nPSIidXRmLTgiIj8+CjxmYWN0dXJhIGlkPSIiY29tcHJvYmFudGUiIiB2ZXJzaW9uPSIiMS4wLjAiIj4KICA8aW5mb1RyaWJ1dGFyaWE+CiAgICA8YW1iaWVudGU+MTwvYW1iaWVudGU+CiAgICA8dGlwb0VtaXNpb24+MTwvdGlwb0VtaXNpb24+CiAgICA8cmF6b25Tb2NpYWw+UElOWk9OIEdPTlpBTEVaIEpVQU4gR1VJTExFUk1PPC9yYXpvblNvY2lhbD4KICAgIDxub21icmVDb21lcmNpYWw+UElOWk9OIEdPTlpBTEVaIEpVQU4gR1VJTExFUk1PPC9ub21icmVDb21lcmNpYWw+CiAgICA8cnVjPjExMDUxNDg5NDIwMDE8L3J1Yz4KICAgIDxjbGF2ZUFjY2Vzbz4wNTEyMjAyMjAxMTEwNTE0ODk0MjAwMTEwMDEwMDEwMDAwMDAwMTAwMDAwMDAwMTEyPC9jbGF2ZUFjY2Vzbz4KICAgIDxjb2REb2M+MDE8L2NvZERvYz4KICAgIDxlc3RhYj4wMDE8L2VzdGFiPgogICAgPHB0b0VtaT4wMDE8L3B0b0VtaT4KICAgIDxzZWN1ZW5jaWFsPjAwMDAwMDAxMDwvc2VjdWVuY2lhbD4KICAgIDxkaXJNYXRyaXo+Sk9TRSBERSBTQU4gTUFSVElOIFNOIFkgU0FMVkFET1IgQUxMRU5ERTwvZGlyTWF0cml6PgogIDwvaW5mb1RyaWJ1dGFyaWE+CiAgPGluZm9GYWN0dXJhPgogICAgPGZlY2hhRW1pc2lvbj4wNS8xMi8yMDIyPC9mZWNoYUVtaXNpb24+CiAgICA8ZGlyRXN0YWJsZWNpbWllbnRvPkpPU0UgREUgU0FOIE1BUlRJTiBTTiBZIFNBTFZBRE9SIEFMTEVOREU8L2RpckVzdGFibGVjaW1pZW50bz4KICAgIDxvYmxpZ2Fkb0NvbnRhYmlsaWRhZD5OTzwvb2JsaWdhZG9Db250YWJpbGlkYWQ+CiAgICA8dGlwb0lkZW50aWZpY2FjaW9uQ29tcHJhZG9yPjA0PC90aXBvSWRlbnRpZmljYWNpb25Db21wcmFkb3I+CiAgICA8cmF6b25Tb2NpYWxDb21wcmFkb3I+SnVhbiBQaW56b248L3Jhem9uU29jaWFsQ29tcHJhZG9yPgogICAgPGlkZW50aWZpY2FjaW9uQ29tcHJhZG9yPjExMDUxNDg5NDIwMDE8L2lkZW50aWZpY2FjaW9uQ29tcHJhZG9yPgogICAgPHRvdGFsU2luSW1wdWVzdG9zPjEyMDA8L3RvdGFsU2luSW1wdWVzdG9zPgogICAgPHRvdGFsRGVzY3VlbnRvPjA8L3RvdGFsRGVzY3VlbnRvPgogICAgPHRvdGFsQ29uSW1wdWVzdG9zPgogICAgICA8dG90YWxJbXB1ZXN0bz4KICAgICAgICA8Y29kaWdvPjI8L2NvZGlnbz4KICAgICAgICA8Y29kaWdvUG9yY2VudGFqZT4wPC9jb2RpZ29Qb3JjZW50YWplPgogICAgICAgIDxkZXNjdWVudG9BZGljaW9uYWw+MDwvZGVzY3VlbnRvQWRpY2lvbmFsPgogICAgICAgIDxiYXNlSW1wb25pYmxlPjEyMDA8L2Jhc2VJbXBvbmlibGU+CiAgICAgICAgPHZhbG9yPjA8L3ZhbG9yPgogICAgICA8L3RvdGFsSW1wdWVzdG8+CiAgICA8L3RvdGFsQ29uSW1wdWVzdG9zPgogICAgPHByb3BpbmE+MDwvcHJvcGluYT4KICAgIDxpbXBvcnRlVG90YWw+MTIwMDwvaW1wb3J0ZVRvdGFsPgogICAgPG1vbmVkYT5Eb2xhcmVzIEVFLlVVPC9tb25lZGE+CiAgICA8cGFnb3M+CiAgICAgIDxwYWdvPgogICAgICAgIDxmb3JtYVBhZ28+MjA8L2Zvcm1hUGFnbz4KICAgICAgICA8dG90YWw+MTIwMDwvdG90YWw+CiAgICAgICAgPHBsYXpvPjA8L3BsYXpvPgogICAgICAgIDx1bmlkYWRUaWVtcG8+RGlhczwvdW5pZGFkVGllbXBvPgogICAgICA8L3BhZ28+CiAgICA8L3BhZ29zPgogIDwvaW5mb0ZhY3R1cmE+CiAgPGRldGFsbGVzPgogICAgPGRldGFsbGU+CiAgICAgIDxjb2RpZ29QcmluY2lwYWw+MDAwMTwvY29kaWdvUHJpbmNpcGFsPgogICAgICA8ZGVzY3JpcGNpb24+UHJvZ3JhbW1pbmcgU2VydmljZXMgYnkgSG91cjwvZGVzY3JpcGNpb24+CiAgICAgIDxjYW50aWRhZD44MDwvY2FudGlkYWQ+CiAgICAgIDxwcmVjaW9Vbml0YXJpbz4xNS4wPC9wcmVjaW9Vbml0YXJpbz4KICAgICAgPGRlc2N1ZW50bz4wPC9kZXNjdWVudG8+CiAgICAgIDxwcmVjaW9Ub3RhbFNpbkltcHVlc3RvPjEyMDA8L3ByZWNpb1RvdGFsU2luSW1wdWVzdG8+CiAgICAgIDxpbXB1ZXN0b3M+CiAgICAgICAgPGltcHVlc3RvPgogICAgICAgICAgPGNvZGlnbz4yPC9jb2RpZ28+CiAgICAgICAgICA8Y29kaWdvUG9yY2VudGFqZT4wPC9jb2RpZ29Qb3JjZW50YWplPgogICAgICAgICAgPHRhcmlmYT4wLjA8L3RhcmlmYT4KICAgICAgICAgIDxiYXNlSW1wb25pYmxlPjEyMDA8L2Jhc2VJbXBvbmlibGU+CiAgICAgICAgICA8dmFsb3I+MC4wPC92YWxvcj4KICAgICAgICA8L2ltcHVlc3RvPgogICAgICA8L2ltcHVlc3Rvcz4KICAgIDwvZGV0YWxsZT4KICA8L2RldGFsbGVzPgogIDxpbmZvQWRpY2lvbmFsPgogICAgPGNhbXBvQWRpY2lvbmFsIG5vbWJyZT0iIkNvcnJlbyBjb21wcmFkb3IiIj5qdWFucGluem9uMTk5MkBnbWFpbC5jb208L2NhbXBvQWRpY2lvbmFsPgogIDwvaW5mb0FkaWNpb25hbD4KPFNpZ25hdHVyZSBJZD0iIlNpZ25hdHVyZTg4NzY2NyIiIHhtbG5zPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnIyIiPjxTaWduZWRJbmZvIElkPSIiU2lnbmF0dXJlLVNpZ25lZEluZm8zODEwNDUiIj48Q2Fub25pY2FsaXphdGlvbk1ldGhvZCBBbGdvcml0aG09IiJodHRwOi8vd3d3LnczLm9yZy9UUi8yMDAxL1JFQy14bWwtYzE0bi0yMDAxMDMxNSIiIC8+PFNpZ25hdHVyZU1ldGhvZCBBbGdvcml0aG09IiJodHRwOi8vd3d3LnczLm9yZy8yMDAwLzA5L3htbGRzaWcjcnNhLXNoYTEiIiAvPjxSZWZlcmVuY2UgSWQ9IiJSZWZlcmVuY2UtSUQtNzk5MDEzIiIgVVJJPSIiI2NvbXByb2JhbnRlIiI+PFRyYW5zZm9ybXM+PFRyYW5zZm9ybSBBbGdvcml0aG09IiJodHRwOi8vd3d3LnczLm9yZy8yMDAwLzA5L3htbGRzaWcjZW52ZWxvcGVkLXNpZ25hdHVyZSIiIC8+PC9UcmFuc2Zvcm1zPjxEaWdlc3RNZXRob2QgQWxnb3JpdGhtPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnI3NoYTEiIiAvPjxEaWdlc3RWYWx1ZT5lNzdHT2VVKzBZZlJTTzVXOXcyVTd0d0dIMEU9PC9EaWdlc3RWYWx1ZT48L1JlZmVyZW5jZT48UmVmZXJlbmNlIFVSST0iIiNDZXJ0aWZpY2F0ZTA2MjM3MSIiPjxEaWdlc3RNZXRob2QgQWxnb3JpdGhtPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnI3NoYTEiIiAvPjxEaWdlc3RWYWx1ZT5aNDRmTGN0SlFpcWFTMkljSFpjRFF4dmhjMDQ9PC9EaWdlc3RWYWx1ZT48L1JlZmVyZW5jZT48UmVmZXJlbmNlIElkPSIiU2lnbmVkUHJvcGVydGllc0lEMDUyODI1IiIgVVJJPSIiI1NpZ25hdHVyZTg4NzY2Ny1TaWduZWRQcm9wZXJ0aWVzMjI0MDY5IiIgVHlwZT0iImh0dHA6Ly91cmkuZXRzaS5vcmcvMDE5MDMjU2lnbmVkUHJvcGVydGllcyIiPjxEaWdlc3RNZXRob2QgQWxnb3JpdGhtPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnI3NoYTEiIiAvPjxEaWdlc3RWYWx1ZT5GZDQ0RkxMSUJicGZ4cnZzWXluNG9oNi9ITFk9PC9EaWdlc3RWYWx1ZT48L1JlZmVyZW5jZT48L1NpZ25lZEluZm8+PFNpZ25hdHVyZVZhbHVlPldLR0hjNHBBNXFLeGVvUUJtR2o0QzJKdTBuM1B0SWJ5aTFrR1QxNjBBeTFVQXZlbk02b3dER3h3Rmw5SWpKc29tUHpXL2h2RDl3N25FU0U4SzNIc0Jad2R3WGZWWkhNYXpQZ1JlRVoybUdiT1ZhTk41U3ZLZUYxbUdzTnZXSGlENytMUjJkVVp0ZGx6Q1NwcEJ0OGpVM2FuQ1dxMlNqVUx2QzVHNVF0L1o5ZTJFYllBcXRveDlNSFQrNjhJRmJnSXJhRk5wUEMySTlOM2h2WjNXUGQ2N0ZBYjVvRkdhbWtrT3I4d0dvSVZJOVIybEI5SFMrdm5acHd6b21JbFhCS25YckR3SWNBT3Fwd25HQW1haERoeHJpRHl6SVdFeWhjVURDOFVhU25LSHN1amF6VTZTY1owQ0c4eWR0WHFCbzh4UVl3WXJ6SEtqUFJ4SzJUZ1N6TXc1dz09PC9TaWduYXR1cmVWYWx1ZT48S2V5SW5mbyBJZD0iIkNlcnRpZmljYXRlMDYyMzcxIiI+PFg1MDlEYXRhPjxYNTA5Q2VydGlmaWNhdGU+TUlJSThEQ0NCdGlnQXdJQkFnSUlCaVNka0RnNktja3dEUVlKS29aSWh2Y05BUUVMQlFBd2diZ3hDekFKQmdOVkJBWVRBa1ZUTVVRd1FnWURWUVFIRER0Q1lYSmpaV3h2Ym1FZ0tITmxaU0JqZFhKeVpXNTBJR0ZrWkhKbGMzTWdZWFFnZDNkM0xuVmhibUYwWVdOaExtTnZiUzloWkdSeVpYTnpLVEVXTUJRR0ExVUVDZ3dOVlVGT1FWUkJRMEVnVXk1QkxqRVZNQk1HQTFVRUN3d01WRk5RTFZWQlRrRlVRVU5CTVJvd0dBWURWUVFEREJGVlFVNUJWRUZEUVNCRFFUSWdNakF4TmpFWU1CWUdBMVVFWVF3UFZrRlVSVk10UVRZMk56SXhORGs1TUI0WERUSXlNVEV4TkRFME1USXdNRm9YRFRJME1URXhNekUwTVRJd01Gb3dnYUl4Q3pBSkJnTlZCQVlUQWtWRE1SZ3dGZ1lEVlFRRURBOVFTVTVhVDA0Z1IwOU9Xa0ZNUlZveEZ6QVZCZ05WQkNvTURrcFZRVTRnUjFWSlRFeEZVazFQTVJrd0Z3WURWUVFGRXhCSlJFTkZReTB4TVRBMU1UUTRPVFF5TVNjd0pRWURWUVFEREI1S1ZVRk9JRWRWU1V4TVJWSk5UeUJRU1U1YVQwNGdSMDlPV2tGTVJWb3hIREFhQmdOVkJHRU1FMVJKVGtWRExURXhNRFV4TkRnNU5ESXdNREV3Z2dFaU1BMEdDU3FHU0liM0RRRUJBUVVBQTRJQkR3QXdnZ0VLQW9JQkFRRE13ZkJoZHRRUXhuaW90TzhuRVNZQ0RrTWhDRSsvNEhTZC9GZ3RKUGNLcDVkWVh6aWJlYWVhUXI2R3ZuSGpEQXRkOE0yMDJSR0N3R3dmeTI0RExpU1htbGczcUh1SVpGUm9IQTE3TzJ4M21GS3VYVkJ2dVp6WjdoSE1FZExMWUk2M0g1TFk3OHovZTFETVd3R0FtYkRBaTdXREw4WkxHc2dwc0JSRGFobUdhdHFqYXNnSjhHY2xGNnBRWlUrNGtXbGF3dGlrMm1DdEJBdjRVS2RjMzhIZ3J1dm1jMlZxTWFBbHh5SEFhZm0zY01mdTgwVS9WVURjYTdWQmk2Z0luNkwyMkI0UWpiZkN5V25WN1VTejd6SkdoUVYvZS9iU1FITXFVcmdSYjdxakVXVmR0ZS9tQTBBNXpFdnI4U29ZQnVWM2RxVkhuUmdWempTaDBGUlM5dmxmQWdNQkFBR2pnZ1FRTUlJRUREQ0Ixd1lJS3dZQkJRVUhBUUVFZ2Nvd2djY3dWUVlJS3dZQkJRVUhNQUtHU1doMGRIQTZMeTkzZDNjdWRXRnVZWFJoWTJFdVkyOXRMM0IxWW14cFl5OWtiM2R1Ykc5aFpDOTBjM0JmWTJWeWRHbG1hV05oZEdWekwzTjFZbTl5WkdsdVlYUmxNUzVqY25Rd05nWUlLd1lCQlFVSE1BR0dLbWgwZEhBNkx5OXZZM053TVM1MVlXNWhkR0ZqWVM1amIyMHZjSFZpYkdsakwzQnJhUzl2WTNOd0x6QTJCZ2dyQmdFRkJRY3dBWVlxYUhSMGNEb3ZMMjlqYzNBeUxuVmhibUYwWVdOaExtTnZiUzl3ZFdKc2FXTXZjR3RwTDI5amMzQXZNQjBHQTFVZERnUVdCQlNVcE0zTXg5eUUvSFpYdzY1MG9mRjlDU0IvOXpBTUJnTlZIUk1CQWY4RUFqQUFNQjhHQTFVZEl3UVlNQmFBRkgxWDUyQnp6Z2RHcWVLamFQRGhFYkowa25QOU1JR1pCZ05WSFNBRWdaRXdnWTR3Z1lzR0RDc0dBUVFCZ3ZFMlpnSUJBVEI3TURjR0NDc0dBUVVGQndJQkZpdG9kSFJ3Y3pvdkwzZDNkeTUxWVc1aGRHRmpZUzVqYjIwdmNIVmliR2xqTDNCcmFTOWtjR010WldNdk1FQUdDQ3NHQVFVRkJ3SUNNRFFNTWtORlVsUkpSa2xEUVVSUElFUkZJRkJGVWxOUFRrRWdUa0ZVVlZKQlRDQlBJRVpKVTBsRFFTQkZUaUJCVWtOSVNWWlBNSUdQQmdOVkhSOEVnWWN3Z1lRd1FLQStvRHlHT21oMGRIQTZMeTlqY213eExuVmhibUYwWVdOaExtTnZiUzl3ZFdKc2FXTXZjR3RwTDJOeWJDOURRVEp6ZFdKdmNtUnBibUZrWVM1amNtd3dRS0Erb0R5R09taDBkSEE2THk5amNtd3lMblZoYm1GMFlXTmhMbU52YlM5d2RXSnNhV012Y0d0cEwyTnliQzlEUVRKemRXSnZjbVJwYm1Ga1lTNWpjbXd3RGdZRFZSMFBBUUgvQkFRREFnWGdNQjBHQTFVZEpRUVdNQlFHQ0NzR0FRVUZCd01DQmdnckJnRUZCUWNEQkRDQ0FZTUdBMVVkRVFTQ0FYb3dnZ0YyZ1JocWRXRnVjR2x1ZW05dU1UazVNa0JuYldGcGJDNWpiMjJnR3dZTEt3WUJCQUdDOFRabUF3R2dEQXdLTVRFd05URTBPRGswTXFBZkJnc3JCZ0VFQVlMeE5tWURBcUFRREE1S1ZVRk9JRWRWU1V4TVJWSk5UNkFYQmdzckJnRUVBWUx4Tm1ZREE2QUlEQVpRU1U1YVQwNmdHUVlMS3dZQkJBR0M4VFptQXdTZ0Nnd0lSMDlPV2tGTVJWcWdOZ1lMS3dZQkJBR0M4VFptQXdlZ0p3d2xTazlUUlNCRVJTQlRRVTRnVFVGU1ZFbE9JRmtnVTBGTVZrRkVUMUlnUVV4TVJVNUVSYUFmQmdzckJnRUVBWUx4Tm1ZRENLQVFEQTR3TURVNU16azRPVFkwTkRVeE1xQVZCZ3NyQmdFRUFZTHhObVlEQ2FBR0RBUk1UMHBCb0I0R0N5c0dBUVFCZ3ZFMlpnTUxvQThNRFRFeE1EVXhORGc1TkRJd01ER2dFd1lMS3dZQkJBR0M4VFptQXd5Z0JBd0NSVU9nS1FZTEt3WUJCQUdDOFRabUF6S2dHZ3dZVUVWU1UwOU9RU0JPUVZSVlVrRk1JRThnUmtsVFNVTkJvQmdHQ3lzR0FRUUJndkUyWmdNem9Ba01CMEZTUTBoSlZrOHdEUVlKS29aSWh2Y05BUUVMQlFBRGdnSUJBTHRPb0ZZa2RvaktwS2ZHR2dVSS9uMlZOZHpnQzdJMm5FYUFuMmo4M0JvQU5vbVM3Smp0NlMwUktVWnJ4ZDFZL3FlVU94ZkNjMjA3eFo3ZGN2NDVRdGRjU0ZRMjE2WmRxR0R4MkdvL3NRR2pmaCtIejVzT0luanhidHp0eElpSEY5dVErUVl3WEQzV243aVU0cXJEQTFDWExXbDk4YnhmMUdoa2J3bzQ0Sk9jaXgvdTk2dWFaRytoNlhma1dVcytKM1JESHQzWkxaQzZFV25xc21uRlh1SG5NdW5pV0lmeHpFeG9pbW1LcDZvVzAwdENOYVN2MkpQUkFUdjFOYVFsUk9Ub2FWZUcvSHRTaE93SFVFMy9tVzFieGE4YXlSS0ZTcnd0UERZc0JoM3AxM3RBTzZZNGN5RGd1cGRJdS9lRTRab282blFKZURDZHUxaUpqL0Q2V2RMYXZFTFA4b1ExMnJESXFFS2hSRGpTWEo4KytuSGhURXJyYklLY1JDd2xocmVwODdzVmk4ZklEeXlDNENuRkx1SHg3dDVpeHBTclVHMUgyZkR4Y0N5NUN6N0lVMmZqQ1ViNmZqYXNBRUlFdklkeU1OL2RKVHdNWmtDeGxzN2tOOTJ6WmxZOEVBWEd1OXB3NHcxVEVSMnRRL1puN3FVRlUweXJLUE5BSFZHc1NpaGhaY1NwWHZZRXEvZU5MTzl5T1crZEpHOFUxY3I1aEZKUnpXc0JXbUNTdXAxZkxsWmMwbHh0SDB2MmtRQ2JpUVlvT09SemE3aEpadlJoeGpFQ1F1NFJTMnNWQU4xVnhHVU5EaHFJRG1GR2ZaNVQ5NlBUVFZkQnJWblJSRThlUlFQcEg2MWFJdVlMU1Q0bUdIRERzcEp5djdqemg3OFMzVEdBZlVva3R1TlQ8L1g1MDlDZXJ0aWZpY2F0ZT48L1g1MDlEYXRhPjxLZXlWYWx1ZT48UlNBS2V5VmFsdWU+PE1vZHVsdXM+ek1Id1lYYlVFTVo0cUxUdkp4RW1BZzVESVFoUHYrQjBuZnhZTFNUM0NxZVhXRjg0bTNtbm1rSytocjV4NHd3TFhmRE50TmtSZ3NCc0g4dHVBeTRrbDVwWU42aDdpR1JVYUJ3TmV6dHNkNWhTcmwxUWI3bWMyZTRSekJIU3kyQ090eCtTMk8vTS8zdFF6RnNCZ0ptd3dJdTFneS9HU3hySUtiQVVRMm9aaG1yYW8ycklDZkJuSlJlcVVHVlB1SkZwV3NMWXBOcGdyUVFMK0ZDblhOL0I0SzdyNW5ObGFqR2dKY2Nod0duNXQzREg3dk5GUDFWQTNHdTFRWXVvQ0oraTl0Z2VFSTIzd3NscDFlMUVzKzh5Um9VRmYzdjIwa0J6S2xLNEVXKzZveEZsWGJYdjVnTkFPY3hMNi9FcUdBYmxkM2FsUjUwWUZjNDBvZEJVVXZiNVh3PT08L01vZHVsdXM+PEV4cG9uZW50PkFRQUI8L0V4cG9uZW50PjwvUlNBS2V5VmFsdWU+PC9LZXlWYWx1ZT48L0tleUluZm8+PE9iamVjdCBJZD0iIlNpZ25hdHVyZTg4NzY2Ny1PYmplY3Q1ODk1NDYiIj48ZXRzaTpRdWFsaWZ5aW5nUHJvcGVydGllcyBUYXJnZXQ9IiIjU2lnbmF0dXJlODg3NjY3IiIgeG1sbnM6ZXRzaT0iImh0dHA6Ly91cmkuZXRzaS5vcmcvMDE5MDMvdjEuMy4yIyIiPjxTaWduZWRQcm9wZXJ0aWVzIElkPSIiU2lnbmF0dXJlODg3NjY3LVNpZ25lZFByb3BlcnRpZXMyMjQwNjkiIiB4bWxucz0iImh0dHA6Ly91cmkuZXRzaS5vcmcvMDE5MDMvdjEuMy4yIyIiPjxldHNpOlNpZ25lZFNpZ25hdHVyZVByb3BlcnRpZXM+PGV0c2k6U2lnbmluZ1RpbWU+MjAyMi0xMi0wNVQyMzo0MTozOS0wNTowMDwvZXRzaTpTaWduaW5nVGltZT48ZXRzaTpTaWduaW5nQ2VydGlmaWNhdGU+PGV0c2k6Q2VydD48ZXRzaTpDZXJ0RGlnZXN0PjxkczpEaWdlc3RNZXRob2QgQWxnb3JpdGhtPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnI3NoYTEiIiB4bWxuczpkcz0iImh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyMiIiAvPjxkczpEaWdlc3RWYWx1ZSB4bWxuczpkcz0iImh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyMiIj5CYnRkcE9LR0xyRithcjJVKzBxdEorM0ZBUzA9PC9kczpEaWdlc3RWYWx1ZT48L2V0c2k6Q2VydERpZ2VzdD48ZXRzaTpJc3N1ZXJTZXJpYWw+PGRzOlg1MDlJc3N1ZXJOYW1lIHhtbG5zOmRzPSIiaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnIyIiPk9JRC4yLjUuNC45Nz1WQVRFUy1BNjY3MjE0OTksIENOPVVBTkFUQUNBIENBMiAyMDE2LCBPVT1UU1AtVUFOQVRBQ0EsIE89VUFOQVRBQ0EgUy5BLiwgTD1CYXJjZWxvbmEgKHNlZSBjdXJyZW50IGFkZHJlc3MgYXQgd3d3LnVhbmF0YWNhLmNvbS9hZGRyZXNzKSwgQz1FUzwvZHM6WDUwOUlzc3Vlck5hbWU+PGRzOlg1MDlTZXJpYWxOdW1iZXIgeG1sbnM6ZHM9IiJodHRwOi8vd3d3LnczLm9yZy8yMDAwLzA5L3htbGRzaWcjIiI+NDQyNjUxOTA2MTMzMzM4NTY5PC9kczpYNTA5U2VyaWFsTnVtYmVyPjwvZXRzaTpJc3N1ZXJTZXJpYWw+PC9ldHNpOkNlcnQ+PC9ldHNpOlNpZ25pbmdDZXJ0aWZpY2F0ZT48ZXRzaTpTaWduZWREYXRhT2JqZWN0UHJvcGVydGllcz48ZXRzaTpEYXRhT2JqZWN0Rm9ybWF0IE9iamVjdFJlZmVyZW5jZT0iIiNSZWZlcmVuY2UtSUQtNzk5MDEzIiI+PGV0c2k6RGVzY3JpcHRpb24+Y29udGVuaWRvIGNvbXByb2JhbnRlPC9ldHNpOkRlc2NyaXB0aW9uPjxldHNpOk1pbWVUeXBlPnRleHQveG1sPC9ldHNpOk1pbWVUeXBlPjwvZXRzaTpEYXRhT2JqZWN0Rm9ybWF0PjwvZXRzaTpTaWduZWREYXRhT2JqZWN0UHJvcGVydGllcz48L2V0c2k6U2lnbmVkU2lnbmF0dXJlUHJvcGVydGllcz48L1NpZ25lZFByb3BlcnRpZXM+PC9ldHNpOlF1YWxpZnlpbmdQcm9wZXJ0aWVzPjwvT2JqZWN0PjwvU2lnbmF0dXJlPjwvZmFjdHVyYT4=";
            string strContent = GetReceptionSoap(base64XmlInvoice);

            //Act
            var response = client.PostRequest(path, strContent).Result;
            string contentResponse = response.Content.ReadAsStringAsync().Result;

            XmlSerializer serializer = new XmlSerializer(typeof(ReceptionEnvelope));
            ReceptionEnvelope test;
            using (StringReader reader = new StringReader(contentResponse))
            {
                test = (ReceptionEnvelope)serializer.Deserialize(reader)!;
            }

            //Assert
            Assert.Equal(HttpStatusCode.OK, response.StatusCode);
            Assert.NotNull(test);
        }

        [Fact]
        public void AuthorizationTest()
        {
            //Arrange
            string url = "https://celcer.sri.gob.ec/comprobantes-electronicos-ws";
            string path = "/AutorizacionComprobantesOffline";
            HttpClientConnection client = new HttpClientConnection(url);

            string accessKey = "0512202201110514894200110010010000000100000000112";
            string strContent = GetAuthorizationSoap(accessKey);
            
            //Act
            var response = client.PostRequest(path, strContent).Result;
            string contentResponse = response.Content.ReadAsStringAsync().Result;

            XmlSerializer serializer = new XmlSerializer(typeof(AuthorizationEnvelope));
            AuthorizationEnvelope test;
            using (StringReader reader = new StringReader(contentResponse))
            {
                test = (AuthorizationEnvelope)serializer.Deserialize(reader)!;
            }

            //Assert
            Assert.Equal(HttpStatusCode.OK, response.StatusCode);
            Assert.NotNull(test);
        }


        private string GetReceptionSoap(string base64XML)
        {
            string soapXML = @"<soapenv:Envelope xmlns:soapenv=""http://schemas.xmlsoap.org/soap/envelope/"" xmlns:ec=""http://ec.gob.sri.ws.recepcion"">
                <soapenv:Header/>
                <soapenv:Body>
                <ec:validarComprobante>
                <!--Optional:-->
                <xml>" + base64XML + @"</xml>
             </ec:validarComprobante>
            </soapenv:Body>
            </soapenv:Envelope>";
            return soapXML;
        }

        private string GetAuthorizationSoap(string accessKey)
        {
            string soapXML = @"<soapenv:Envelope xmlns:soapenv=""http://schemas.xmlsoap.org/soap/envelope/"" xmlns:ec=""http://ec.gob.sri.ws.autorizacion"">
                                   <soapenv:Header/>
                                   <soapenv:Body>
                                      <ec:autorizacionComprobante>
                                         <!--Optional:-->
                                         <claveAccesoComprobante>" + accessKey + @"</claveAccesoComprobante>
                                      </ec:autorizacionComprobante>
                                   </soapenv:Body>
                                </soapenv:Envelope>";
            return soapXML;
        }
    }
}